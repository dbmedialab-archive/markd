/*! jquery-markd - v0.1.0 - 2013-07-28 */
!function($){var pub={init:function(options){return this.each(function(){var $this=$(this);if(void 0===$this.data("markd")&&($this.addClass("markd mousetrap"),$this.data("markd",$.extend({},$.fn.markd.defaults,options,{is_fullscreen:!1,preview:{}}))),$this.data("markd").autosave&&"undefined"!=typeof Storage&&void 0!==$this.attr("data-autosave-key")&&(0===pub.getContent.apply($this).length&&pub.open.apply($this),$this.data("markd").autosave=!0),!$this.is("textarea")){var t=$this.html();pub.setContent.apply($this,[t.replace(/(\r\n|\n|\r)/gm,"")])}$this.data("markd").parser.compiler.setOptions({pedantic:$this.data("markd").parser.pedantic,sanitize:$this.data("markd").parser.sanitize}),$this.data("markd"),$this.bind("focus",function(){priv.focus.apply($this)}),$this.bind("blur",function(){priv.blur.apply($this)})})},getContent:function(){var content=[];return this.each(function(){var $this=$(this);content.push(priv.getContent.apply($this))}),content},setContent:function(content){return this.each(function(){var $this=$(this);$this.data("markd"),$this.is("textarea")?$this.val(content):(content=content.replace(/(\r\n|\n|\r)/gm,"<br>"),$this.html(content))})},setCursor:function(position){return this.each(function(){var $this=$(this),t=priv.getContent.apply($this);if(!$this.is("textarea")){var newlines=t.substr(0,position).match(/(\r\n|\n|\r)/gm);null!==newlines&&(position-=newlines.length)}$this.selection(position,position)})},getMarkdown:function(){var content=[];return this.each(function(){var $this=$(this),data=$this.data("markd");content.push(data.parser.compiler(priv.getContent.apply($this)))}),content},createPreview:function(theme){return this.each(function(){var $this=$(this),p={};void 0===theme&&(theme=$this.data("markd").theme),p.el=$('<iframe class="markd-preview"></iframe>'),$("body").prepend(p.el),p.innards=priv.getIframeInnards(p.el[0]),p.innards.open(),p.innards.write(""),p.innards.close(),p.head=$("head",p.innards),p.body=$("body",p.innards),p.head.append('<link rel="stylesheet" href="'+theme+'" />'),$this.data("markd").preview=p})},deletePreview:function(){return this.each(function(){var $this=$(this),data=$this.data("markd");void 0!==data.preview.el&&data.preview.el.remove(),$this.data("markd").preview={}})},open:function(key){return this.each(function(){var $this=$(this);void 0===key&&(key=$this.attr("data-autosave-key"));var content=localStorage.getItem(key);null!==content&&pub.setContent.apply($this,[content])})},save:function(key,content){return this.each(function(){var $this=$(this);void 0===key&&(key=$this.attr("data-autosave-key")),void 0===content&&(content=priv.getContent.apply($this)),localStorage.setItem(key,content)})},clear:function(key){return this.each(function(){var $this=$(this);void 0===key&&(key=$this.attr("data-autosave-key")),localStorage.removeItem(key)})}},priv={focus:function(){var $this=$(this),data=$this.data("markd");data.autosave&&$this.bind("keyup",function(){pub.save.apply($this)}),Mousetrap.bind("tab",function(){var s=priv.getSelection.apply($this),t=priv.getContent.apply($this);return t=priv.insert(t,s.end,"	"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+1]),!1}),Mousetrap.bind(data.keyboardShortcuts.link,function(){var s=priv.getSelection.apply($this),t=priv.getContent.apply($this),l=t.substring(s.start,s.end).match(/(http|https|ftp):\/\//);return null!==l?(t=priv.insert(t,s.end,")"),t=priv.insert(t,s.start,"[]("),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.start+1])):(t=priv.insert(t,s.end,"]()"),t=priv.insert(t,s.start,"["),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+3])),!1}),Mousetrap.bind(data.keyboardShortcuts.code,function(){var s=priv.getSelection.apply($this),t=priv.getContent.apply($this);return t=priv.insert(t,s.end,"`"),t=priv.insert(t,s.start,"`"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+2]),!1}),Mousetrap.bind(data.keyboardShortcuts.bold,function(){var s=priv.getSelection.apply($this),t=priv.getContent.apply($this);return t=priv.insert(t,s.end,"__"),t=priv.insert(t,s.start,"__"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+4]),!1}),Mousetrap.bind(data.keyboardShortcuts.italic,function(){var s=priv.getSelection.apply($this),t=priv.getContent.apply($this);return t=priv.insert(t,s.end,"_"),t=priv.insert(t,s.start,"_"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+2]),!1}),Mousetrap.bind(data.keyboardShortcuts.help,function(){return window.open("http://daringfireball.net/projects/markdown/syntax","_blank"),!1}),Mousetrap.bind(data.keyboardShortcuts.preview,function(){if(!data.is_fullscreen)if(void 0===$this.data("markd").preview.el){var offset=$this.offset();pub.createPreview.apply($this),preview=$this.data("markd").preview,preview.el.css({position:"absolute",top:offset.top,left:offset.left,width:$this.outerWidth(),height:$this.outerHeight()}),preview.body.html(data.parser.compiler(priv.getContent.apply($this))),Mousetrap.bind("esc",function(){pub.deletePreview.apply($this),Mousetrap.unbind("esc")})}else pub.deletePreview.apply($this),Mousetrap.unbind("esc");return!1}),Mousetrap.bind(data.keyboardShortcuts.fullscreen,function(){return void 0!==$this.data("markd").preview.el&&pub.deletePreview.apply($this),data.is_fullscreen?(data.is_fullscreen=!1,$this.removeClass("fullscreen"),$this.unbind("keyup"),$this.unbind("scroll"),Mousetrap.unbind("esc"),pub.deletePreview.apply($this)):(data.is_fullscreen=!0,$this.addClass("fullscreen"),pub.createPreview.apply($this),preview=$this.data("markd").preview,preview.el.addClass("fullscreen"),$this.bind("keyup",function(){preview.body.html(data.parser.compiler(priv.getContent.apply($this))),priv.paralellScroll.apply($this)}),$this.bind("scroll",function(){priv.paralellScroll.apply($this)}),Mousetrap.bind("esc",function(){data.is_fullscreen=!1,$this.removeClass("fullscreen"),$this.unbind("keyup"),$this.unbind("scroll"),Mousetrap.unbind("esc"),pub.deletePreview.apply($this)})),!1})},blur:function(){var $this=$(this),data=$this.data("markd");data.autosave&&$this.unbind("keyup"),Mousetrap.unbind("tab"),Mousetrap.unbind(data.keyboardShortcuts.bold),Mousetrap.unbind(data.keyboardShortcuts.italic),Mousetrap.unbind(data.keyboardShortcuts.link),Mousetrap.unbind(data.keyboardShortcuts.help),Mousetrap.unbind(data.keyboardShortcuts.preview),Mousetrap.unbind(data.keyboardShortcuts.fullscreen),data.is_fullscreen||pub.deletePreview.apply($this)},insert:function(string,index,insert){return index>0?string.substring(0,index)+insert+string.substring(index,string.length):insert+string},getContent:function(){var $this=$(this);if($this.is("textarea"))return $this.val();var content;return content=document.getElementById($this.attr("id")).innerText?document.getElementById($this.attr("id")).innerText:document.getElementById($this.attr("id")).textContent,content=content.replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getSelection:function(){var $this=$(this),selection=$this.selection();if(!$this.is("textarea")){var t=priv.getContent.apply($this).substr(0,selection.end),newlines=t.match(/(\r\n|\n|\r)/gm);if(null!==newlines){var n=priv.getContent.apply($this).substr(0,selection.end+newlines.length).match(/(\r\n|\n|\r)/gm);selection.start+=n.length,selection.end+=n.length,priv.getContent.apply($this).substring(selection.start,selection.end).match(/(\r\n|\n|\r)/gm)&&(selection.start++,selection.end++)}}return selection},getIframeInnards:function(el){return el.contentDocument||el.contentWindow.document},paralellScroll:function(){var $this=$(this),preview=$this.data("markd").preview,maxScrollOffsetEditor=$this.get(0).scrollHeight-$this.get(0).clientHeight,percentageScrolledEditor=100/maxScrollOffsetEditor*$this.get(0).scrollTop,maxScrollOffsetPreview=preview.body.get(0).scrollHeight-preview.body.get(0).clientHeight,scrollTo=maxScrollOffsetPreview/100*percentageScrolledEditor;preview.body.scrollTop(scrollTo)}};$.fn.markd=function(method){return pub[method]?pub[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?($.error("Method "+method+" does not exist on jQuery.markd"),void 0):pub.init.apply(this,arguments)},$.fn.markd.defaults={autosave:!0,theme:"preview.css",keyboardShortcuts:{bold:"ctrl+b",italic:"ctrl+i",code:"ctrl+k",link:"ctrl+l",help:"ctrl+h",preview:"ctrl+p",fullscreen:"ctrl+f"},parser:{compiler:window.marked,pedantic:!1,sanitize:!1}}}(jQuery);
/*
//@ sourceMappingURL=jquery-markd.sourcemap.js
*/