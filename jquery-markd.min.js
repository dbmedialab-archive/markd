/*! jquery-markd - v0.2.0 - 2013-09-06 */
!function($){var pub={init:function(options){return this.each(function(){var $this=$(this);if(void 0===$this.data("markd")&&($this.addClass("markd mousetrap"),$this.data("markd",$.extend({},$.fn.markd.defaults,options,{is_fullscreen:!1,preview:{}}))),$this.data("markd").autosave&&"undefined"!=typeof Storage&&void 0!==$this.attr("data-autosave-key")&&(0===pub.getContent.apply($this).length&&pub.open.apply($this),$this.data("markd").autosave=!0),!$this.is("textarea")){var t=$this.html();pub.setContent.apply($this,[t.replace(/(\r\n|\n|\r)/gm,"")])}$this.data("markd").parser.compiler.setOptions({pedantic:$this.data("markd").parser.pedantic,sanitize:$this.data("markd").parser.sanitize}),$this.data("markd"),$this.bind("focus",function(){priv.focus.apply($this)}),$this.bind("blur",function(){priv.blur.apply($this)})})},getContent:function(){var content=[];return this.each(function(){var $this=$(this);content.push(priv.getContent.apply($this))}),content},setContent:function(content){return this.each(function(){var $this=$(this);$this.data("markd"),$this.is("textarea")?$this.val(content):(content=content.replace(/(\r\n|\n|\r)/gm,"<br>"),$this.html(content))})},setCursor:function(position){return this.each(function(){var $this=$(this),t=priv.getContent.apply($this);if(!$this.is("textarea")){var newlines=t.substr(0,position).match(/(\r\n|\n|\r)/gm);null!==newlines&&(position-=newlines.length)}$this.selection(position,position)})},getHtml:function(){var content=[];return this.each(function(){var $this=$(this),data=$this.data("markd");content.push(data.parser.compiler(priv.getContent.apply($this)))}),content},createPreview:function(theme){return this.each(function(){var $this=$(this),p={};void 0===theme&&(theme=$this.data("markd").theme),p.el=$('<iframe class="markd-preview"></iframe>'),$("body").prepend(p.el),p.innards=priv.getIframeInnards(p.el[0]),p.innards.open(),p.innards.write(""),p.innards.close(),p.head=$("head",p.innards),p.body=$("body",p.innards),p.head.append('<link rel="stylesheet" href="'+theme+'" />'),$this.data("markd").preview=p})},deletePreview:function(){return this.each(function(){var $this=$(this),data=$this.data("markd");void 0!==data.preview.el&&data.preview.el.remove(),$this.data("markd").preview={}})},open:function(key){return this.each(function(){var $this=$(this);void 0===key&&(key=$this.attr("data-autosave-key"));var content=localStorage.getItem(key);null!==content&&pub.setContent.apply($this,[content])})},save:function(key,content){return this.each(function(){var $this=$(this);void 0===key&&(key=$this.attr("data-autosave-key")),void 0===content&&(content=priv.getContent.apply($this)),localStorage.setItem(key,content)})},clear:function(key){return this.each(function(){var $this=$(this);void 0===key&&(key=$this.attr("data-autosave-key")),localStorage.removeItem(key)})}},priv={tab:function(){var $this=$(this),s=priv.getSelection.apply($this),t=priv.getContent.apply($this);t=priv.insert(t,s.end,"	"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+1])},link:function(){var $this=$(this),s=priv.getSelection.apply($this),t=priv.getContent.apply($this),l=t.substring(s.start,s.end).match(/(http|https|ftp):\/\//);null!==l?(t=priv.insert(t,s.end,")"),t=priv.insert(t,s.start,"[]("),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.start+1])):(t=priv.insert(t,s.end,"]()"),t=priv.insert(t,s.start,"["),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+3]))},code:function(){var $this=$(this),s=priv.getSelection.apply($this),t=priv.getContent.apply($this);t=priv.insert(t,s.end,"`"),t=priv.insert(t,s.start,"`"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+2])},bold:function(){var $this=$(this),s=priv.getSelection.apply($this),t=priv.getContent.apply($this);t=priv.insert(t,s.end,"__"),t=priv.insert(t,s.start,"__"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+4])},italic:function(){var $this=$(this),s=priv.getSelection.apply($this),t=priv.getContent.apply($this);t=priv.insert(t,s.end,"_"),t=priv.insert(t,s.start,"_"),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+2])},quote:function(){var $this=$(this),s=priv.getSelection.apply($this),t=priv.getContent.apply($this);t=0===t.substr(s.start-1,1).search(/\n/g)?priv.insert(t,s.start,"> "):priv.insert(t,s.start,"\n> "),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.end+3])},createPreview:function(){var $this=$(this),data=$this.data("markd"),offset=$this.offset();pub.createPreview.apply($this),preview=$this.data("markd").preview,preview.el.css({position:"absolute",top:offset.top,left:offset.left,width:$this.outerWidth(),height:$this.outerHeight()}),preview.body.html(data.parser.compiler(priv.getContent.apply($this))),Mousetrap.bind("esc",function(){priv.deletePreview.apply($this)})},deletePreview:function(){var $this=$(this);pub.deletePreview.apply($this),Mousetrap.unbind("esc")},togglePreview:function(){var $this=$(this),data=$this.data("markd");data.is_fullscreen||(void 0===$this.data("markd").preview.el?priv.createPreview.apply($this):priv.deletePreview.apply($this))},enterFullscreen:function(){var $this=$(this),data=$this.data("markd");void 0!==$this.data("markd").preview.el&&pub.deletePreview.apply($this),data.is_fullscreen=!0,$this.addClass("fullscreen"),pub.createPreview.apply($this),preview=$this.data("markd").preview,preview.el.addClass("fullscreen"),$this.bind("keyup",function(){preview.body.html(data.parser.compiler(priv.getContent.apply($this))),priv.paralellScroll.apply($this)}),$this.bind("scroll",function(){priv.paralellScroll.apply($this)}),Mousetrap.bind("esc",function(){priv.exitFullscreen.apply($this)})},exitFullscreen:function(){var $this=$(this),data=$this.data("markd");data.is_fullscreen=!1,$this.removeClass("fullscreen"),$this.unbind("keyup"),$this.unbind("scroll"),Mousetrap.unbind("esc"),pub.deletePreview.apply($this)},toggleFullscreen:function(){var $this=$(this),data=$this.data("markd");data.is_fullscreen?priv.exitFullscreen.apply($this):priv.enterFullscreen.apply($this)},statistics:function(){var $this=$(this),$text=$("<div>"+pub.getHtml.apply($this)[0]+"</div>");alert("Antall tegn: "+$text.text().length+"\nAntall ord: "+$text.text().split(" ").length+"\nAntall avsnitt: "+$text.find(">p").length)},pasteHtmlToMarkdown:function(){var $this=$(this),clipboard=prompt("Lim inn html","");clipboard=toMarkdown(clipboard);var s=priv.getSelection.apply($this),t=priv.getContent.apply($this);t=s.start!=s.end?t.slice(0,s.start)+clipboard+t.slice(s.end,t.length):priv.insert(t,s.start,clipboard),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.start+clipboard.length])},pasteRemovFormating:function(){var $this=$(this),clipboard=prompt("Lim inn","");clipboard=clipboard.replace(/(<([^>]+)>)/gi,"");var s=priv.getSelection.apply($this),t=priv.getContent.apply($this);t=s.start!=s.end?t.slice(0,s.start)+clipboard+t.slice(s.end,t.length):priv.insert(t,s.start,clipboard),pub.setContent.apply($this,[t]),pub.setCursor.apply($this,[s.start+clipboard.length])},focus:function(){var $this=$(this),data=$this.data("markd");$(".markd-toolbar")&&($(".markd-toolbar .action.bold").unbind("click").on("click",function(){priv.bold.apply($this),$(".markd-toolbar").hide()}),$(".markd-toolbar .action.italic").unbind("click").on("click",function(){priv.italic.apply($this),$(".markd-toolbar").hide()}),$(".markd-toolbar .action.quote").unbind("click").on("click",function(){priv.quote.apply($this),$(".markd-toolbar").hide()}),$(".markd-toolbar .action.link").unbind("click").on("click",function(){priv.link.apply($this),$(".markd-toolbar").hide()}),$(document).unbind("mouseup").on("mouseup",function(event){var selection=priv.getSelection.apply($this);if(selection.width){var xy={top:event.pageY-45,left:event.pageX-$(".markd-toolbar").width()/2};$(".markd-toolbar").show().css(xy)}else $(".markd-toolbar").hide()})),data.autosave&&$this.bind("keyup",function(){pub.save.apply($this)}),Mousetrap.bind("mod+shift+v",function(){return priv.pasteRemovFormating.apply($this),!1}),Mousetrap.bind("mod+alt+v",function(){return priv.pasteHtmlToMarkdown.apply($this),!1}),Mousetrap.bind(data.keyboardShortcuts.statistics,function(){return priv.statistics.apply($this),!1}),Mousetrap.bind("tab",function(){return priv.tab.apply($this),!1}),Mousetrap.bind(data.keyboardShortcuts.link,function(){return priv.link.apply($this),!1}),Mousetrap.bind(data.keyboardShortcuts.code,function(){return priv.code.apply($this),!1}),Mousetrap.bind(data.keyboardShortcuts.bold,function(){return priv.bold.apply($this),!1}),Mousetrap.bind(data.keyboardShortcuts.italic,function(){return priv.italic.apply($this),!1}),Mousetrap.bind(data.keyboardShortcuts.help,function(){return window.open("http://daringfireball.net/projects/markdown/syntax","_blank"),!1}),Mousetrap.bind(data.keyboardShortcuts.preview,function(){return priv.togglePreview.apply($this),!1}),Mousetrap.bind(data.keyboardShortcuts.fullscreen,function(){return priv.toggleFullscreen.apply($this),!1})},blur:function(){var $this=$(this),data=$this.data("markd");data.autosave&&$this.unbind("keyup"),Mousetrap.unbind("tab"),Mousetrap.unbind(data.keyboardShortcuts.bold),Mousetrap.unbind(data.keyboardShortcuts.italic),Mousetrap.unbind(data.keyboardShortcuts.link),Mousetrap.unbind(data.keyboardShortcuts.help),Mousetrap.unbind(data.keyboardShortcuts.preview),Mousetrap.unbind(data.keyboardShortcuts.fullscreen),Mousetrap.unbind(data.keyboardShortcuts.statistics),Mousetrap.unbind("mod+shift+v"),Mousetrap.unbind("mod+alt+v"),data.is_fullscreen||pub.deletePreview.apply($this)},insert:function(string,index,insert){return index>0?string.substring(0,index)+insert+string.substring(index,string.length):insert+string},getContent:function(){var $this=$(this);if($this.is("textarea"))return $this.val();var content;return content=document.getElementById($this.attr("id")).innerText?document.getElementById($this.attr("id")).innerText:document.getElementById($this.attr("id")).textContent,content=content.replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getSelection:function(){var $this=$(this),selection=$this.selection();if(!$this.is("textarea")){var t=priv.getContent.apply($this).substr(0,selection.end),newlines=t.match(/(\r\n|\n|\r)/gm);if(null!==newlines){var n=priv.getContent.apply($this).substr(0,selection.end+newlines.length).match(/(\r\n|\n|\r)/gm);selection.start+=n.length,selection.end+=n.length,priv.getContent.apply($this).substring(selection.start,selection.end).match(/(\r\n|\n|\r)/gm)&&(selection.start++,selection.end++)}}return selection},getIframeInnards:function(el){return el.contentDocument||el.contentWindow.document},paralellScroll:function(){var $this=$(this),preview=$this.data("markd").preview,maxScrollOffsetEditor=$this.get(0).scrollHeight-$this.get(0).clientHeight,percentageScrolledEditor=100/maxScrollOffsetEditor*$this.get(0).scrollTop,maxScrollOffsetPreview=preview.body.get(0).scrollHeight-preview.body.get(0).clientHeight,scrollTo=maxScrollOffsetPreview/100*percentageScrolledEditor;preview.body.scrollTop(scrollTo)}};$.fn.markd=function(method){return pub[method]?pub[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?($.error("Method "+method+" does not exist on jQuery.markd"),void 0):pub.init.apply(this,arguments)},$.fn.markd.defaults={autosave:!0,theme:"preview.css",keyboardShortcuts:{bold:"mod+b",italic:"mod+i",code:"mod+k",link:"mod+l",help:"mod+h",preview:"mod+p",fullscreen:"mod+f",statistics:"mod+alt+i"},parser:{compiler:window.marked,pedantic:!1,sanitize:!1}}}(jQuery);
/*
//@ sourceMappingURL=jquery-markd.sourcemap.js
*/